{% include 'designer_header.html' %}

<div style="margin-bottom: 1em;background:url('/static/assets/img/inter.jpg') ; height: 300px; width: 100%; background-size: cover;" >
</div>

<center>
    <form method="post" enctype="multipart/form-data" >
        <h3>Manage Design And Plan</h3>
        {% if data['up'] %}
        <table>
            <tr>
                <th>Design Name</th>
                <td><input type="text" required name="name" value="{{data['up'][0]['designname']}}" class="form-control"></td>
            </tr>
            <tr>
                <th>Design Details</th>
                <td><input type="text" value="{{data['up'][0]['details']}}" required name="details" class="form-control"></td>
            </tr>
            <tr>
                <th>Design Images</th>
                <td><input type="file" value="{{data['up'][0]['path']}}" required name="image" class="form-control"></td>
            </tr>
            <tr>
                <td colspan="2" align="center"><input type="submit" name="update" value="Upload" class="btn btn-info"></td>
            </tr>
        </table>

        {% else %}
        <table>
            <tr>
                <th>Category Name</th>
                <td>
                    <select name="category_id" id="category_id" class="form-control">
                        {% for i in data['catview'] %}
                        <option value="{{i['category_id'] }}">{{i['category_name']}}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <th>Sub Category Name</th>
                <td>
                    <select name="sub_category_id" id="sub_category_id" class="form-control">
                        <!-- Subcategories will be populated here based on category selection -->
                    </select>
                </td>
            </tr>
            <tr>
                <th>Design Name</th>
                <td><input type="text" required name="name" class="form-control"></td>
            </tr>
            <tr>
                <th>Design Details</th>
                <td><input type="text" required name="details" class="form-control"></td>
            </tr>
            <tr>
                <th>Design Images</th>
                <td><input type="file" required name="image" class="form-control"></td>
            </tr>
            <tr>
                <td colspan="2" align="center"><input type="submit" name="submit" value="Upload" class="btn btn-info"></td>
            </tr>
        </table>
        {% endif %}
        <br><br>

        <table>
            <tr>
                <th>Index</th>
                <th>Design Name</th>
                <th>Design Details</th>
                <th>Design Image</th>
                <th></th><th></th>
            </tr>
            {% for i in data['view'] %}
            <tr>
                <td>{{loop.index}}</td>
                <td>{{i['designname']}}</td>
                <td>{{i['details']}}</td>
                <td><a href="/{{i['path']}}"><img src="/{{i['path']}}" width="100" height="100" alt="Designer Image"></a></td>
                <td><a href="?action=update&des_id={{i['design_id']}}&img_id={{i['image_id']}}" class="btn btn-info">Update</a></td>
                <td><a href="?action=delete&des_id={{i['design_id']}}&img_id={{i['image_id']}}" class="btn btn-danger">Delete</a></td>
            </tr>
            {% endfor %}
        </table>
    </form>
</center>

{% include 'footer.html' %}

<!-- Add JavaScript to handle category change and load subcategories -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#category_id').change(function() {
            var categoryId = $(this).val();
            if (categoryId) {
                $.ajax({
                    url: '/get_subcategories',
                    type: 'GET',
                    data: { category_id: categoryId },
                    success: function(response) {
                        var subCategorySelect = $('#sub_category_id');
                        subCategorySelect.empty();  // Clear existing options
                        subCategorySelect.append('<option value="">Select Subcategory</option>');  // Default option

                        // Append the fetched subcategories to the dropdown
                        $.each(response, function(index, subCategory) {
                            subCategorySelect.append('<option value="' + subCategory.sub_category_id + '">' + subCategory.subcategory_name + '</option>');
                        });
                    }
                });
            }
        });
    });
</script>
